---
title: 请求-数据解析
hide_title: true
hide_table_of_contents: false
slug: request-parse
---
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

:::note MIME类型

MIME 即**互联网媒体类型**，也称作**内容类型**（Content-Type）。

常用于表示互联网传输内容赋予的分类类型。

:::

Pywss 支持多种数据类型解析。

## Byte
Pywss 应用可以通过 **`ctx.body()`** 获取原生请求体数据。

<Tabs className="unique-tabs">
<TabItem value="服务端" label="服务端" default>

```python
import pywss

def handler(ctx: pywss.Context):
    assert ctx.body() == b"pywss"

app = pywss.App()
app.post("/byte", handler)
app.run()
```

</TabItem>
<TabItem value="客户端" label="客户端">

```python
import requests

reqoests.post(
    "http://localhost:8080/byte",
    data="pywss"
)
```

</TabItem>
</Tabs>


## Json
Pywss 应用可以通过 **`ctx.json()`** 获取原生请求体数据，并将其转化为 **_JSON_** 类型。

<Tabs className="unique-tabs">
<TabItem value="服务端" label="服务端" default>

```python
import pywss

def handler(ctx: pywss.Context):
    assert ctx.json() == {"name": "pywss"}

app = pywss.App()
app.post("/json", handler)
app.run()
```

</TabItem>
<TabItem value="客户端" label="客户端">

```python
import requests

reqoests.post(
    "http://localhost:8080/json",
    json={
        "name": "pywss",
    }
)
```

</TabItem>
</Tabs>


## Form
Pywss 应用可以通过 **`ctx.form()`** 获取原生请求体数据，并将其转化为 **_FORM_** 表单类型。

<Tabs className="unique-tabs">
<TabItem value="服务端" label="服务端" default>

```python
import pywss

def handler(ctx: pywss.Context):
    assert ctx.form() == {"name": "pywss"}

app = pywss.App()
app.post("/form", handler)
app.run()
```

</TabItem>
<TabItem value="客户端" label="客户端">

```python
import requests

reqoests.post(
    "http://localhost:8080/form",
    data={
        "name": "pywss",
    }
)
```

</TabItem>
</Tabs>


## File
Pywss 应用可以通过 **`ctx.file()`** 获取原生请求体数据，并将其转化为 **_FILE_** 类型。

<Tabs className="unique-tabs">
<TabItem value="服务端" label="服务端" default>

```python
import pywss

def handler(ctx: pywss.Context):
    file: pywss.File = ctx.file()["file"]
    assert file.name = "file"
    assert file.filename = "file.txt"
    assert isinstance(file.content, byte)

app = pywss.App()
app.post("/file", handler)
app.run()
```
```python title="pywss.File"
class File:

    def __init__(self, name, filename, content):
        self.name: str = name
        self.filename: str = filename
        self.content: bytes = content
```

</TabItem>
<TabItem value="客户端" label="客户端">

```python
import requests

reqoests.post(
    "http://localhost:8080/file",
    files={
        "file": open("file.txt", "rb"),
    }
)
```

</TabItem>
<TabItem value="file.txt" label="file.txt">

```text
0036757B8FF4120B5F2344F3886EA2AD
0036757B8FF4120B5F2344F3886EA2AD
0036757B8FF4120B5F2344F3886EA2AD
0036757B8FF4120B5F2344F3886EA2AD
0036757B8FF4120B5F2344F3886EA2AD
0036757B8FF4120B5F2344F3886EA2AD
0036757B8FF4120B5F2344F3886EA2AD
0036757B8FF4120B5F2344F3886EA2AD
0036757B8FF4120B5F2344F3886EA2AD
0036757B8FF4120B5F2344F3886EA2AD
0036757B8FF4120B5F2344F3886EA2AD
```

</TabItem>
</Tabs>


## Stream
Pywss 应用可以通过 **`ctx.stream()`** 流式读取原生请求体数据。这在大文件上传场景下会很有用。

<Tabs className="unique-tabs">
<TabItem value="服务端-流式读取" label="服务端-流式读取" default>

```python
import pywss

def handler(ctx: pywss.Context):
    for data in ctx.stream(size=32):  # 按指定大小返回数据
        print(data)

app = pywss.App()
app.post("/stream", handler)
app.run()
```

</TabItem>
<TabItem value="服务端-逐行读取" label="服务端-逐行读取" default>

```python
import pywss

def handler(ctx: pywss.Context):
    for data in ctx.stream(readline=True):  # 逐行返回数据
        print(data)
        assert b"0036757B8FF4120B5F2344F3886EA2AD" in data

app = pywss.App()
app.post("/stream", handler)
app.run()
```

</TabItem>
<TabItem value="客户端" label="客户端">

```python
import requests

reqoests.post(
    "http://localhost:8080/stream",
    data=open("bigfile.txt", "rb")
)
```
</TabItem>
<TabItem value="bigfile.txt" label="bigfile.txt">

```text
0036757B8FF4120B5F2344F3886EA2AD
0036757B8FF4120B5F2344F3886EA2AD
0036757B8FF4120B5F2344F3886EA2AD
0036757B8FF4120B5F2344F3886EA2AD
0036757B8FF4120B5F2344F3886EA2AD
0036757B8FF4120B5F2344F3886EA2AD
0036757B8FF4120B5F2344F3886EA2AD
0036757B8FF4120B5F2344F3886EA2AD
0036757B8FF4120B5F2344F3886EA2AD
0036757B8FF4120B5F2344F3886EA2AD
0036757B8FF4120B5F2344F3886EA2AD
```

</TabItem>
</Tabs>
