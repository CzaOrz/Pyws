---
title: 路由-匹配机制
hide_title: true
hide_table_of_contents: false
slug: route-match
---

export const Highlight = ({children}) => (
  <span
    style={{
      backgroundColor: '#f1f0d8',
      borderRadius: '10px',
      color: 'red',
      padding: '0.4rem',
      fontWeight: 700,
    }}>
    {children}
  </span>
);


## 特殊路由匹配机制

:::note 什么是特殊路由匹配机制？

通常来说 **匹配机制** 有：
- **全等匹配**：-
- **头部匹配**：-
- **尾部匹配**：-
- **局部匹配**：判断是否满足局部匹配
- **正则匹配**：判断是否满足正则匹配

在路由管理中，**包含多种匹配模式**的机制我们都称之为特殊路由匹配机制。

:::

**特殊路由匹配机制** 是现代 web 框架必不可少的特点。

对于大多数的框架而言，它们都支持**正则匹配**，虽然这会带来更丰富的能力，但这无疑也会引入一定的性能问题。

Pywss 通过更简单、易懂的方式实现了三种路由匹配机制，包括：

|匹配机制|说明|
|---|---|
|**全等匹配**|`app.get("/full/match", handler)`|
|**局部匹配**|`app.get("/party/match/{name}", handler)`，变量 **name** 会存储在**`ctx.route_params`**中|
|**头部匹配**|`app.get("/head/match/*", handler)`，此处需以 `*` 结尾|

**_注意_**：
上述匹配机制无法同时生效，且存在优先级，即 **全等匹配** > **局部匹配** > **头部匹配**。

**全等匹配**此处不在赘述。下面主要介绍：
- **局部匹配**
- **头部匹配**

## 局部匹配
Pywss 在配置路由时，通过 <Highlight>大括号</Highlight> 区分 **局部匹配**。

在指定 **局部匹配** 后会生成 **"路径参数"**，此参数可以在 `ctx.route_params` 中获取。

```python title="获取路径参数"
import pywss

def hello(ctx: pywss.Context):
    name = ctx.route_params["name"]
    ctx.write({"hello": name})

app = pywss.App()
app.get("/hello/{name}", hello)
app.run()
```

受限于实现机制，在局部匹配中**暂不支持对类型的校验**。

## 头部匹配
Pywss 在配置路由时，通过尾部配置 <Highlight>*</Highlight> 可以区分 **头部匹配**。

```python title="头部匹配"
import pywss

def hello(ctx: pywss.Context):
    name = ctx.route.replace("/hello/", "", 1)
    ctx.write({"hello": name})

app = pywss.App()
app.get("/hello/*", hello)
app.run()
```
在此模式下，任意以 `/route/` 开头的路由均可以命中此路由。
