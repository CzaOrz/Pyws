---
title: 视图机制
hide_title: true
hide_table_of_contents: false
slug: app-view
---
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

## 视图机制

:::note 什么是视图机制？

对于熟悉 Django RESTful 设计风格和开发方式的同学来说，可能会对 **视图机制** 有一定了解。

在 Python 中，**视图机制** 指的是通过特殊方法和语法来实现自定义对象的不同视图或视角，以提供对对象的不同表示和操作方式。

在 RESTful 风格中，我们通常以不同的 HTTP Method 来区分对资源的操作：

- GET：获取资源
- POST：新增资源
- ...

所以，在 web 开发过程中，这种对资源的完整行为的表达方式，我们称之为 **视图机制**。

:::

Pywss 通过 **`app.view`** 实现了简单的视图机制，以便更加友好的支持 RESTful 风格代码。

为了区别于常规路由注册方法，在**视图类**中我们通过 **`http`** 前缀来指定路由方法：

- **`http_get`**
- **`http_post`**
- **`http_delete`**
- **`http_put`**
- ...

下面我们通过一个 **用户视图** 来说明。

```python title="用户视图" showLineNumbers {28}
import pywss

class UserView:

    def http_get(self, ctx: pywss.Context):
        ctx.write({
            "code": 0,
            "method": "GET",
            "message": "获取用户成功",
        })

    def http_post(self, ctx: pywss.Context):
        ctx.write({
            "code": 0,
            "method": "POST",
            "message": "创建用户成功",
        })

    def http_delete(self, ctx: pywss.Context):
        ctx.write({
            "code": 0,
            "method": "DELETE",
            "message": "删除用户成功",
        })

def main():
    app = pywss.App()
    app.view("/api/user", UserView())  # 注意此处是一个实例
    app.run()

if __name__ == '__main__':
    main()
```

在此案例中，我们针对 **"用户"** 这个资源，提供了 **获取、创建、删除** 三种操作。

需要注意的是，在案例28行，`app.view` 注册了一个用户视图 **实例**。这里需要特别区分基于 **`@classmethod`** 实现的视图类。理论二者无显著差异。

此外，视图内部是**非线程安全的**，这意味在操作公共资源的时候，需要加锁。
